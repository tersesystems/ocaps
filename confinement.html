<!DOCTYPE html>
<html class="no-js" lang="eng" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confining Capabilities</title>
    <link rel="stylesheet" href="theme/css/foundation.min.css">
    <link rel="stylesheet" href="theme/css/app.css">
    
     <link rel="stylesheet" href="theme/highlight.js/styles/github-gist.css">  <link rel="stylesheet" href="theme/css/foundation-icons.custom.css"> 
    
     <link rel="prev" href="authorization.html"  title="Authorizing Capabilities"  />  <link rel="next" href="other_works.html"  title="Other works"  />  <link rel="start" href="index.html"  title="Introduction"  />  <link rel="toc" href="site-contents.html"  title="Table of Contents"  /> 
  </head>
  <body>
    <div class="expanded row">
      <div class="small-12 medium-12 large-12 columns align-self-top">
        <div class="row">
          
          <header class="large-12 columns align-self-top a_header">
            <div class="row">
              <div class="large-12 columns a_limited top-bar">
                <div class="top-bar-left">
                  <p>ocaps Manual</p>

                </div>
                <div class="top-bar-right align-right row">
                  
                  
                    <form action="site-search.html" method="get" class="align-right a_search">
                      <input name="q" type="search"  placeholder="Search
" >
                      <button><img alt="&#1F50D;" src="theme/images/search.svg" /></button>
                    </form>
                  
                </div>
              </div>
            </div>
          </header>
          
          <div class="small-12 medium-12 large-12 columns align-self-top a_limited a_main">
            <div class="row">
              
              <main class="columns large-order-2 sections" id="_sections">
                 
  <ul class="menu align-right simple a_navbar a_navbar_top">
    
      
        <li><a href="authorization.html"  title="Authorizing Capabilities" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="other_works.html"  title="Other works" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
                
                <h1 id="confining-capabilities" class="a_section" data-magellan-target="confining-capabilities">Confining Capabilities<a class="a_hlink" href="#confining-capabilities"></a></h1>
<p>Managing capabilities in the context of an architecture can be complex.</p>
<p>Design patterns of capability patterns can be hard to manage.  One way to package capabilities is to use <em>composition</em>, but it may also make sense to organize capabilities in a tree structure connected to resources.</p>
<blockquote>
<p>[I]f your abstraction requires 15 distinct capabilities to get its job done, does its constructor take a flat list of 15 objects? What an unwieldy, annoying constructor! Instead, a better approach is to logically group these capabilities into separate objects, and maybe even use contextual storage like parents and children to make fetching them easier. – <a href="http://joeduffyblog.com/2015/11/10/objects-as-secure-capabilities/">Objects as Secure Capabilities, Joe Duffy</a></p>
</blockquote>
<p>One issue is that managing capabilities can mean limiting scope and access to an object reference, but many architectures assume a context in which all object references are publically accessible – for example, events may be sent across an event bus, or through a streaming model.  And because data structures inherently involve object references, there’s the question of how to keep capabilities safe and isolated.</p>
<p>We touched on this a little bit in the <code class="hljs">Access</code> class which uses access modifiers and a companion object to construct capabilities which cannot be accessed directly.  Unfortunately, in Scala, <a href="http://www.jesperdj.com/2016/01/08/scala-access-modifiers-and-qualifiers-in-detail/">access modifiers and qualifiers only apply to enclosing scope</a>, so there is no way to qualify private access to things outside that scope.  However, there is a way to protect capabilities to produce this effect – through the use of <code class="hljs">Brand</code>.</p>
<h2 id="encapsulating-capabilities-with-brands" class="a_section" data-magellan-target="encapsulating-capabilities-with-brands">Encapsulating Capabilities with Brands<a class="a_hlink" href="#encapsulating-capabilities-with-brands"></a></h2>
<p>A Brand is a means of “<a href="https://people.mpi-sws.org/~dreyer/papers/ocpl/paper.pdf">providing data abstraction in the absence of static typing</a>.”  It consists of a sealing function, which provides a “boxed” reference to the capability <strong>which cannot be opened</strong>, and an unsealing function, which takes the box, and returns the contained capability. The best way of describing it is that a Brand provides both a canner and the associated can opener.</p>
<div class="row"><div class="a_linked small-expand columns a_xscroll a_codeblock">
<pre class="hljs"><code class="language-scala"><span class="hljs-keyword">import</span> ocaps.<span class="hljs-type">Brand</span>

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Main</span> </span>{
  <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Food</span>(<span class="hljs-params">name: <span class="hljs-type">String</span></span>)</span>
  <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Can</span>(<span class="hljs-params">food: <span class="hljs-type">Brand</span>.<span class="hljs-type">Box</span>[<span class="hljs-type">Food</span>]</span>)</span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CanOpener</span>(<span class="hljs-params">unsealer: <span class="hljs-type">Brand</span>.<span class="hljs-type">Unsealer</span>[<span class="hljs-type">Food</span>]</span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">open</span></span>(can: <span class="hljs-type">Can</span>): <span class="hljs-type">Food</span> = {
      unsealer(can.food).get <span class="hljs-comment">// throws exception if we did not seal this</span>
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span></span>(args: <span class="hljs-type">Array</span>[<span class="hljs-type">String</span>]): <span class="hljs-type">Unit</span> = {
    <span class="hljs-keyword">val</span> (sealer, unsealer) = <span class="hljs-type">Brand</span>.create[<span class="hljs-type">Food</span>](<span class="hljs-string">"canned food"</span>).tuple
    <span class="hljs-keyword">val</span> canOfSpam: <span class="hljs-type">Can</span> = <span class="hljs-type">Can</span>(sealer(<span class="hljs-type">Food</span>(<span class="hljs-string">"spam"</span>)))

    <span class="hljs-keyword">val</span> cannedFood: <span class="hljs-type">Brand</span>.<span class="hljs-type">Box</span>[<span class="hljs-type">Food</span>] = canOfSpam.food
    println(<span class="hljs-string">s"food = <span class="hljs-subst">${canOfSpam.food.toString}</span>"</span>) <span class="hljs-comment">// DOES NOT WORK</span>
    <span class="hljs-keyword">val</span> canOpener = <span class="hljs-keyword">new</span> <span class="hljs-type">CanOpener</span>(unsealer)

    <span class="hljs-comment">// We need both Can and CanOpener to unseal.</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">openCan</span></span>(can: <span class="hljs-type">Can</span>, canOpener: <span class="hljs-type">CanOpener</span>) = {
      <span class="hljs-keyword">val</span> food: <span class="hljs-type">Food</span> = canOpener.open(can)
      println(<span class="hljs-string">s"food = <span class="hljs-subst">$food</span>"</span>) <span class="hljs-comment">// WORKS</span>
    }

    openCan(canOfSpam, canOpener)
  }
}
</code></pre>
</div></div>
<p>Because both an unsealer and the sealed item are necessary to unseal, the act of unsealing is inherently a case of <em>amplification</em>, where putting two capabilities together lets you do things that neither one could do individually.</p>
<p>Because dynamic sealing is</p>
<p>Signing</p>
<p>Encryption</p>
<p>Private Channel</p>
<p>Fuck yes, this is awesome.</p>
<p>https://blog.acolyer.org/2016/10/19/protection-in-programming-languages/</p>
<p>I think there is a use case I’m not accounting for – in an Akka actor system hierarchy, you could have multiple actors that were all of the same type, but implement dynamic sealing to provide the same kind of “dynamic private” access privacy when passing messages – so the parent may have the unsealer but the children do not.  Is this more in line with how sealers are used in practice?</p>
<p>Okay, so https://people.mpi-sws.org/~dreyer/papers/ocpl/paper.pdf says</p>
<blockquote>
<p>We now consider one of the oldest and most influential OCPs: dynamic sealing, also called the sealer-unsealer pattern. Originally proposed by Morris [1973], dynamic sealing makes it possible to support data abstraction in the absence of static typing. In this section, we show how OCPL supports compositional reasoning about dynamic sealing. In particular, we show how to implement dynamic sealing in HLA and how to give a compositional specification for this implementation, from which we derive useful specifications for interesting abstractions built on top of it and prove robust safety for representative clients. (We consider an alternative implementation of the OCP, satisfying a slightly weaker specification, in Appendix A. We also show how ideal specifications for cryptographic signing and encryption primitives can be derived from the specification of dynamic sealing in Appendix B.)</p>
</blockquote>
<blockquote>
<p>The functionality of dynamic sealing. Morris [1973] introduced dynamic sealing to enforce data abstraction while interoperating with untrusted, potentially ill-typed code. He stipulated a function makeseal for generating pairs of functions (seal, unseal), such that (i) for every value v, seal v returns a value v ′ serving as an opaque, low-integrity proxy for v; and (ii) for every value v ′ , unseal v ′ returns v, if v ′ was produced by seal v, and otherwise gets stuck. The key point is that this seal-unseal pair supports data abstraction: the client of these functions can freely pass sealed values to untrusted code since they are low-integrity, while at the same time imposing whatever internal invariant it wants on the underlying values that they represent.</p>
</blockquote>
<p>Paper on sealers (which does not actually have that word in it, only the operations Seal and Unseal) http://www.erights.org/history/morris73.pdf</p>
<p>https://ai.google/research/pubs/pub45568</p>
<p>http://www.cis.upenn.edu/~bcpierce/papers/infohide3.pdf</p>
<p>https://blog.acolyer.org/2016/10/19/protection-in-programming-languages/</p>
<h2 id="confining-operations-with-membranes" class="a_section" data-magellan-target="confining-operations-with-membranes">Confining Operations with Membranes<a class="a_hlink" href="#confining-operations-with-membranes"></a></h2>
<p>A membrane is an extension of a <code class="hljs">Revocable</code> that transitively imposes revocability on all
references exchanged via the membrane.</p>
<ul>
<li><a href="http://blog.ezyang.com/2013/03/what-is-a-membran/">What is a Membrane?</a></li>
<li><a href="https://research.google.com/pubs/pub40736.html">Trustworthy Proxies: Virtualizing Objects with Invariants</a></li>
<li>https://web.archive.org/web/20160408162552/http://www.eros-os.org/pipermail/e-lang/2003-January/008434.html</li>
</ul>
<p>Membranes are supposed to stop messages passing from one place to another without being wrapped.</p>
<p>The generalized way to implement a membrane in Java and Scala is to use an <code class="hljs">InvocationHandler</code> as a dynamic proxy.</p>
<ul>
<li>http://www.baeldung.com/java-dynamic-proxies</li>
<li>https://www.concretepage.com/java/dynamic-proxy-with-proxy-and-invocationhandler-in-java</li>
</ul>
<p>There are two ways to implement membranes in a type safe way.</p>
<p>The first is to have a membrane class which will wrap everything, and have the membrane act as an effect.  This does require classes to “opt in” to the membrane.</p>
<p>The second is to make all capabilities take an implicit membrane context.</p>
<ul>
<li><a href="https://www.info.ucl.ac.be/~pvr/rr2005-03.pdf">Capability confinement by membranes</a></li>
</ul>
<p>TODO</p>
<p>// http://wiki.erights.org/wiki/Walnut/Secure_Distributed_Computing/Capability_Patterns#Membranes
// http://blog.ezyang.com/2013/03/what-is-a-membran/</p>

                 
  <ul class="menu align-right simple a_navbar a_navbar_bottom">
    
      
        <li><a href="authorization.html"  title="Authorizing Capabilities" ><span class="a_foundation_icon"></span>  Previous</a></li>
      
    
      
        <li><a href="other_works.html"  title="Other works" ><span class="a_foundation_icon"></span>  Next</a></li>
      
    
      
        <li><a href="site-contents.html"  title="Table of Contents" ><span class="a_foundation_icon"></span>  Contents</a></li>
      
    
  </ul>
 
              </main>
              
              
                <div data-sticky-container class="small-12 medium-12 large-2 large-order-1 columns a_sitenav_container">
                  <nav class="a_sitenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                    
                    <ul>
                       
  <li >
    
      
        <a href="index.html">Introduction</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="running.html">Running</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="guide.html">A Guide To Capabilities</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="introduction.html">Introducing Capabilities</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="creation.html">Creating Capabilities</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="management.html">Managing Capabilities</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="authorization.html">Authorizing Capabilities</a>
      
    
    
  </li>
  
  <li  class="a_thispage" >
    
      
        <a href="confinement.html">Confining Capabilities</a>
      
    
    
  </li>
  
  <li >
    
      
        <a href="other_works.html">Other works</a>
      
    
    
  </li>
 
                    </ul>
                    
                    
                  </nav>
                </div>
              
              
              
                <div class="small-12 medium-12 large-2 large-order-3 columns a_show-for-xlarge" data-sticky-container>
                  <nav class="a_pagenav" data-sticky data-sticky-on="large" data-anchor="_sections">
                     <header><p>On This Page</p>
</header> 
                    <ul class="vertical menu" data-magellan>
                       
  
    <li>
      
         <a href="#confining-capabilities">Confining Capabilities</a> 
      
      
        <ul class="vertical menu">  
  
    <li>
      
         <a href="#encapsulating-capabilities-with-brands">Encapsulating Capabilities with Brands</a> 
      
      
    </li>
  
  
  
    <li>
      
         <a href="#confining-operations-with-membranes">Confining Operations with Membranes</a> 
      
      
    </li>
  
  </ul>
      
    </li>
  
 
                    </ul>
                  </nav>
                </div>
              
            </div>
          </div>
        </div>
      </div>
      
      <footer class="small-12 medium-12 large-12 columns align-self-bottom a_footer">
        <div class="row">
          <div class="small-12 medium-12 large-12 columns top-bar">
            <div class="top-bar-left">
              <p>© Copyright 2018 Will Sargent</p>

            </div>
            <div class="top-bar-right">
              <p>Generated with <a href="https://github.com/szeiger/ornate">Ornate</a>.</p>

            </div>
          </div>
        </div>
      </footer>
    </div>
    
    <script src="theme/js/jquery.min.js"></script>
    <script src="theme/js/what-input.min.js"></script>
    <script src="theme/js/foundation.min.js"></script>
    
    <script src="theme/js/app.js"></script>
    
  </body>
</html>
