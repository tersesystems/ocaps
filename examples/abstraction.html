<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="ocaps">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="ocaps">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Abstraction Â· ocaps</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" type="text/css" href="../assets/stylesheets/mermaid.css"/>
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="ocaps" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
ocaps
</span>
<span class="md-header-nav__topic">
Abstraction
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="ocaps">
ocaps
</a>
</label>
<ul>
  <li><a href="../running.html" class="page">Running</a></li>
  <li><a href="../examples/index.html" class="page">Examples</a>
  <ul>
    <li><a href="../examples/construction/index.html" class="page">Construction</a></li>
    <li><a href="../examples/composition.html" class="page">Composition</a></li>
    <li><a href="../examples/attenuation.html" class="page">Attenuation</a></li>
    <li><a href="../examples/modulation.html" class="page">Modulation</a></li>
    <li><a href="../examples/revocation.html" class="page">Revocation</a></li>
    <li><a href="../examples/expiration.html" class="page">Expiration</a></li>
    <li><a href="../examples/amplification.html" class="page">Amplification</a></li>
    <li><a href="../examples/abstraction.html" class="active page">Abstraction</a></li>
    <li><a href="../examples/delegation.html" class="page">Delegation</a></li>
    <li><a href="../examples/gatekeeper.html" class="page">Gatekeeper</a></li>
    <li><a href="../examples/dynamic_seal.html" class="page">Dynamic Sealing</a></li>
    <li><a href="../examples/membrane.html" class="page">Membrane</a></li>
  </ul></li>
  <li><a href="../guide/index.html" class="page">A Guide To Capabilities</a>
  <ul>
    <li><a href="../guide/introduction.html" class="page">Introducing Capabilities</a></li>
    <li><a href="../guide/construction.html" class="page">Constructing Capabilities</a></li>
    <li><a href="../guide/authorization.html" class="page">Authorizing Capabilities</a></li>
    <li><a href="../guide/management.html" class="page">Managing Capabilities</a></li>
    <li><a href="../guide/confinement.html" class="page">Confining Capabilities</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.1*
</div>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#abstraction" name="abstraction" class="anchor"><span class="anchor-link"></span></a>Abstraction</h1>
<p>Packing lower level capabilities into more convenient APIs. See <a href="https://github.com/GravityNetwork/Gravity/wiki/What-are-Capabilities#abstraction">definition</a>. </p>
<p>This is different from <a href="abstraction.html">abstraction</a> in that abstraction works to perform an operation using the lower level capabilities, but that operation could have been performed by working with the lower level capabilities individually i.e. no new functionality was revealed.</p>
<p>Here&rsquo;s an example of a repository exposed with several facets, with a higher level <code>NameChanger</code> capability composed out of two lower level ones.</p>
<pre class="prettyprint"><code class="language-scala">/**
  * Demonstrates exposing capabilities as facets of a repository, so individual elements are exposed.
  *
  * The capabilities use tagless final to show how you can use different effects with capabilities.
  *
  * For example, the Id effect is an identity, so a failure will cause an exception.
  *
  * The Try effect is a disjoint union with Exception, so a failure will return Failure(Exception) as a result.
  */
object RepositoryComposition {
  val ID = UUID.fromString(&quot;c31d34e2-5892-4a2d-9fd5-3ce2e0efedf7&quot;)

  import ItemRepository._

  val access = new ItemRepository.Access()

  def main(args: Array[String]): Unit = {
    val itemRepository = new ItemRepository()

    changeWithId(itemRepository)
    changeWithTry(itemRepository)
  }

  def changeWithId(itemRepository: ItemRepository): Unit = {
    val idNameChanger = new NameChanger[Id](
      access.finder(itemRepository),
      access.updater(itemRepository),
      _.map(identity)
    )
    val idResult = idNameChanger.changeName(ID, &quot;new name&quot;)
    println(s&quot;id result = $idResult&quot;)
  }

  def changeWithTry(itemRepository: ItemRepository): Unit = {
    val idFinder = access.finder(itemRepository)
    val tryFinder = new Finder[Try] {
      override def find(id: UUID): Try[Option[Item]] = Try(idFinder.find(id))
    }

    val idUpdater = access.updater(itemRepository)
    val tryUpdater = new Updater[Try] {
      override def update(item: Item): Try[UpdateResult] =
        Try(idUpdater.update(item))
    }

    val tryNameChanger = new NameChanger[Try](tryFinder, tryUpdater, {
      case Success(Some(result)) =&gt; result.map(Some(_))
      case Success(None)         =&gt; Success(None)
      case Failure(ex)           =&gt; Failure(ex)
    })
    val tryResult = tryNameChanger.changeName(ID, &quot;new name&quot;)
    println(s&quot;try result = $tryResult&quot;)
  }

  class NameChanger[G[_]: Functor](
    finder: Finder[G],
    updater: Updater[G],
    transform: G[Option[G[UpdateResult]]] =&gt; G[Option[UpdateResult]]
  ) {
    def changeName(id: UUID, newName: String): G[Option[UpdateResult]] = {
      val saved: G[Option[G[UpdateResult]]] = finder.find(id).map {
        maybeItem: Option[Item] =&gt;
          maybeItem.map { item =&gt;
            updater.update(item.copy(name = newName))
          }
      }
      transform(saved)
    }
  }

  case class Item(id: UUID, name: String)

  class ItemRepository {
    import ItemRepository._

    private val items = Seq(Item(ID, &quot;item name&quot;))

    private def find(id: UUID): Option[Item] = items.find(_.id == id)

    private def update(u: Item): UpdateResult = UpdateResult(s&quot;item $u updated&quot;)

    private object capabilities {
      val finder: Finder[Id] = new Finder[Id]() {
        override def find(id: UUID): Id[Option[Item]] =
          ItemRepository.this.find(id)
      }
      val updater: Updater[Id] = new Updater[Id]() {
        override def update(item: Item): Id[UpdateResult] =
          ItemRepository.this.update(item)
      }
    }
  }

  object ItemRepository {
    trait Finder[F[_]] {
      def find(id: UUID): F[Option[Item]]
    }

    trait Updater[F[_]] {
      def update(item: Item): F[UpdateResult]
    }

    case class UpdateResult(message: String)

    class Access {
      def finder(repo: ItemRepository): Finder[Id] = repo.capabilities.finder
      def updater(repo: ItemRepository): Updater[Id] = repo.capabilities.updater
    }

    class TryAccess(access: Access) {
      def finder(repo: ItemRepository): Finder[Try] = new Finder[Try] {
        override def find(id: UUID): Try[Option[Item]] = Try(access.finder(repo).find(id))
      }
      def updater(repo: ItemRepository): Updater[Try] = new Updater[Try] {
        override def update(item: Item): Try[UpdateResult] = Try(access.updater(repo).update(item))
      }
    }
  }

}</code></pre><a href="https://github.com/wsargent/ocaps/tree/master/src/test/scala/ocaps/examples/RepositoryComposition.scala#L26-L147">Full source at GitHub</a>
</div>
<div>
<a href="https://github.com/wsargent/ocaps/tree/master/src/paradox/examples/abstraction.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../examples/amplification.html" title="Amplification" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Amplification
</span>
</div>
</a>
<a href="../examples/delegation.html" title="Delegation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Delegation
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript" src="../assets/javascripts/mermaid/7.1.2/mermaid.min.js"></script>
<script type="text/javascript" src="../assets/javascripts/mermaid-load.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>