<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="ocaps">
<meta name="generator" content="Paradox, paradox-material-theme=0.4.0, mkdocs-material=2.2.2">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.language" content="">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="ocaps">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Confining Capabilities Â· ocaps</title>
<link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../lib/modernizr/modernizr.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
<label class="md-overlay" data-md-component="overlay" for="drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="ocaps" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
ocaps
</span>
<span class="md-header-nav__topic">
Confining Capabilities
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="search"></label>
<div class="md-search__inner">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
<label class="md-icon md-search__icon" for="search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</span>
<a href="../index.html" title="ocaps">
ocaps
</a>
</label>
<ul>
  <li><a href="../running.html" class="page">Running</a></li>
  <li><a href="../examples/index.html" class="page">Examples</a>
  <ul>
    <li><a href="../examples/construction.html" class="page">Construction</a></li>
    <li><a href="../examples/effects.html" class="page">Construction with Effects</a></li>
    <li><a href="../examples/subtypes.html" class="page">Construction with Subtypes</a></li>
    <li><a href="../examples/composition.html" class="page">Composition</a></li>
    <li><a href="../examples/attenuation.html" class="page">Attenuation</a></li>
    <li><a href="../examples/modulation.html" class="page">Modulation</a></li>
    <li><a href="../examples/revocation.html" class="page">Revocation</a></li>
    <li><a href="../examples/amplification.html" class="page">Amplification</a></li>
    <li><a href="../examples/delegation.html" class="page">Delegation</a></li>
    <li><a href="../examples/gatekeeper.html" class="page">Gatekeeper</a></li>
    <li><a href="../examples/dynamic_seal.html" class="page">Dynamic Sealing</a></li>
    <li><a href="../examples/membrane.html" class="page">Membrane</a></li>
  </ul></li>
  <li><a href="../guide/index.html" class="page">A Guide To Capabilities</a>
  <ul>
    <li><a href="../guide/introduction.html" class="page">Introducing Capabilities</a></li>
    <li><a href="../guide/construction.html" class="page">Constructing Capabilities</a></li>
    <li><a href="../guide/authorization.html" class="page">Authorizing Capabilities</a></li>
    <li><a href="../guide/management.html" class="page">Managing Capabilities</a></li>
    <li><a href="../guide/confinement.html" class="active page">Confining Capabilities</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../guide/confinement.html#confining-capabilities" class="header">Confining Capabilities</a>
  <ul>
    <li><a href="../guide/confinement.html#encapsulating-capabilities-with-brands" class="header">Encapsulating Capabilities with Brands</a></li>
    <li><a href="../guide/confinement.html#confining-operations-with-membranes" class="header">Confining Operations with Membranes</a></li>
  </ul></li>
</ul>
</nav>

<div class="md-nav__title--site md-version" title="Version">
<i class="md-icon">label_outline</i> 0.1.1*
</div>
</nav>

</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="toc">Table of contents</label>
<ul>
  <li><a href="../guide/confinement.html#confining-capabilities" class="header">Confining Capabilities</a>
  <ul>
    <li><a href="../guide/confinement.html#encapsulating-capabilities-with-brands" class="header">Encapsulating Capabilities with Brands</a></li>
    <li><a href="../guide/confinement.html#confining-operations-with-membranes" class="header">Confining Operations with Membranes</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#confining-capabilities" name="confining-capabilities" class="anchor"><span class="anchor-link"></span></a>Confining Capabilities</h1>
<p>Managing capabilities in the context of an architecture can be complex. </p>
<p>One issue is that managing capabilities can mean limiting scope and access to an object reference, but many architectures assume a context in which all object references are publically accessible &ndash; for example, events may be sent across an event bus, or through a streaming model. And because data structures inherently involve object references, there&rsquo;s the question of how to keep capabilities safe and isolated.</p>
<p>We touched on this a little bit in the <code>Access</code> class which uses access modifiers and a companion object to construct capabilities which cannot be accessed directly. Unfortunately, in Scala, <a href="http://www.jesperdj.com/2016/01/08/scala-access-modifiers-and-qualifiers-in-detail/">access modifiers and qualifiers only apply to enclosing scope</a>, so there is no way to qualify private access to things outside that scope. However, there is a way to protect capabilities to produce this effect &ndash; through the use of <code>Brand</code>.</p>
<h2><a href="#encapsulating-capabilities-with-brands" name="encapsulating-capabilities-with-brands" class="anchor"><span class="anchor-link"></span></a>Encapsulating Capabilities with Brands</h2>
<p>A Brand is a means of &ldquo;<a href="https://people.mpi-sws.org/~dreyer/papers/ocpl/paper.pdf">providing data abstraction in the absence of static typing</a>.&rdquo; It consists of a sealing function, which provides a &ldquo;boxed&rdquo; reference to the capability <strong>which cannot be opened</strong>, and an unsealing function, which takes the box, and returns the contained capability. The best way of describing it is that a Brand provides both a canner and the associated can opener.</p>
<pre class="prettyprint"><code class="language-scala">import ocaps.Brand

object Main {
  case class Food(name: String)
  case class Can(food: Brand.Box[Food])
  class CanOpener(unsealer: Brand.Unsealer[Food]) {
    def open(can: Can): Food = {
      unsealer(can.food).get // throws exception if we did not seal this
    }
  }

  def main(args: Array[String]): Unit = {
    val (sealer, unsealer) = Brand.create[Food](&quot;canned food&quot;).tuple
    val canOfSpam: Can = Can(sealer(Food(&quot;spam&quot;)))

    val cannedFood: Brand.Box[Food] = canOfSpam.food
    println(s&quot;food = ${canOfSpam.food.toString}&quot;) // DOES NOT WORK
    val canOpener = new CanOpener(unsealer)

    // We need both Can and CanOpener to unseal.
    def openCan(can: Can, canOpener: CanOpener) = {
      val food: Food = canOpener.open(can)
      println(s&quot;food = $food&quot;) // WORKS
    }

    openCan(canOfSpam, canOpener)
  }
}
</code></pre>
<p>Because both an unsealer and the sealed item are necessary to unseal, the act of unsealing is inherently a case of <em>amplification</em>, where putting two capabilities together lets you do things that neither one could do individually.</p>
<p>Sealers can be used for many things. It&rsquo;s helpful to think of them in the context where you would use public key encryption, for example</p>
<ul>
  <li>Signing &ndash; an box can be passed around and an unsealer on a resource can be made public, attesting to its origin.</li>
  <li>Encryption &ndash; a public sealer can &ldquo;encrypt&rdquo; information by boxing it, and sending it to an actor with the sealer.</li>
  <li>Assurance &ndash; boxed information can be passed out and round tripped to the original source, ensuring that the information has not been modified in transit.</li>
  <li>Private Channel &ndash; two actors can pass information to each other using sealed boxes, ensuring that sensitive information is not exposed even if the message is intercepted or <code>LoggingReceive</code> is enabled.</li>
</ul>
<p>One possible application of dynamic sealing is that all <code>Access</code> objects can be sealed and safely bound in a dependency injection framework, and a revocable unsealer capability can be passed around to enable access from a central gatekeeper. I still need to implement this, but I think it&rsquo;s fairly straightforward.</p>
<pre class="prettyprint"><code class="language-scala">// import scalaguice so we don&#39;t use new TypeLiteral[Box[Foo.Access]] {}
class Module extends ScalaModule {
  def configure() = {
    bind[Box[Foo.Access]]
     .toProvider(fooAccessProvider)
     .in(Scopes.SINGLETON)
  }
}
</code></pre>
<p>This can also be used to pass around &ldquo;root level&rdquo; objects such as database connections and JSSE key managers that you may want to restrict access to generally. Anyone using the database connection will have to unseal it, and you can provide the unsealer capability to use revocation or logging to flush it out.</p>
<p>Please see the <a href="../examples/dynamic_seal.html">Dynamic Sealing example</a> for a demonstration.</p>
<p>Dynamic sealing has an independent lineage from capabilities programming. The original paper, <a href="http://www.erights.org/history/morris73.pdf">Protection in Programming Languages</a> was written in 1973, However, the morning paper <a href="https://blog.acolyer.org/2016/10/19/protection-in-programming-languages/">summary on the paper</a> is actually clearer and better written than the paper itself.</p>
<p><a href="https://people.mpi-sws.org/~dreyer/papers/ocpl/paper.pdf">Robust and Compositional Verification of Object  Capability Patterns</a> has a section on dynamic sealing.</p>
<p>The discussion on the use of dynamic sealing in communication channels is from <a href="https://www.cl.cam.ac.uk/~pes20/versions-popl.pdf">Modules, Abstract Types, and Distributed Versioning</a>.</p>
<h2><a href="#confining-operations-with-membranes" name="confining-operations-with-membranes" class="anchor"><span class="anchor-link"></span></a>Confining Operations with Membranes</h2>
<p>A membrane is an extension of a <code>Revocable</code> that transitively imposes revocability on all references exchanged via the membrane. </p>
<p>Membranes are supposed to stop messages passing from one place to another without being wrapped. They are most commonly used for <a href="https://web.archive.org/web/20160408162552/http://www.eros-os.org/pipermail/e-lang/2003-January/008434.html">&ldquo;uncooperative revocation&rdquo;</a>, although any effect can be applied with a membrane, not just revocation.</p>
<p>Membranes are useful in a situation in which you have to run some foreign code in a sandbox, and you absolutely do not trust it. Tellingly, the papers above implement membranes using Javascript, where any website can tell code to be run locally in the browser. Mozilla uses capabilities heavily internally, and membranes ensure an airgap between the browser&rsquo;s internal code and the code available to the site Javascript.</p>
<p>The JVM is not a great platform for implementing a completely safe membranae. In particular, the JVM SecurityManager is easily subverted, and Java Serialization attacks mean that the boundary is very hard to enforce.</p>
<p>In general, the best way to implement a membrane in Java would be to implement a generic method interceptor in <a href="http://bytebuddy.net/#/">Byte Buddy</a> and attach behavior outside of the context of &ldquo;normal&rdquo; Java code.</p>
<p>However, because membranes can implement any effect, and because membranes have a strong conceptual affinity with some FP concepts, it&rsquo;s actually very easy to implement &ldquo;co-operative revocation&rdquo; using a dependently typed effect. This is best called a &ldquo;permeable membrane&rdquo;, because it is an opt-in system that only works if the effect is propagated.</p>
<p>Please see the <a href="../examples/membrane.html">Membrane example</a> for details how Membrane is used in <code>ocaps</code>.</p>
<p>The clearest layman explanation of membranes is <a href="http://blog.ezyang.com/2013/03/what-is-a-membran/">What is a Membrane?</a> by Edward Z. Yang. </p>
<p><a href="https://research.google.com/pubs/pub40736.html">Trustworthy Proxies: Virtualizing Objects with Invariants</a> is an implementation of membranes in Javascript, although somehow the abstract completely avoids that word.</p>
</div>
<div>
<a href="https://github.com/wsargent/ocaps/tree/master/src/paradox/guide/confinement.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.1*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../guide/management.html" title="Managing Capabilities" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Managing Capabilities
</span>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.5165553b.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
